<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Place your fragments — The Collective Canvas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&display=swap" rel="stylesheet">

<style>
body { background:#0b0b0b; color:#f5f5f5; font-family:Inter,sans-serif; margin:0; text-align:center; }
h1 { margin-top:40px; font-size:28px; }
#canvas-container { position:relative; display:inline-block; margin-top:20px; }
canvas { image-rendering: pixelated; border:1px solid #222; cursor:pointer; width:600px; height:600px; }
#loupe { position:absolute; pointer-events:none; border:2px solid #fff; border-radius:50%; display:none; width:200px; height:200px; }
#counter { margin-top:20px; font-size:16px; }
</style>
</head>

<body>
<h1>Place your fragments</h1>
<p>Click or drag to place your pixels. Use the loupe to see details.</p>

<div id="canvas-container">
  <canvas id="canvas" width="1000" height="1000"></canvas>
  <canvas id="loupe" width="200" height="200"></canvas>
</div>

<div id="counter">Pixels remaining: <span id="pixels-remaining">0</span></div>

<script>
// === INIT ===
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const loupe = document.getElementById('loupe');
const ctxLoupe = loupe.getContext('2d');
const counterSpan = document.getElementById('pixels-remaining');

let pixelsToPlace = parseInt(new URLSearchParams(window.location.search).get('pixels')) || 1;
let selectedColor = new URLSearchParams(window.location.search).get('color') || '#FF0000';
counterSpan.textContent = pixelsToPlace;

const grid = new Uint8Array(1000000); // 1000x1000
function index(x,y){ return y*1000 + x; }

// === DRAG & CLICK PLACEMENT ===
let isDragging = false;

function placePixel(x,y){
  if(pixelsToPlace<=0 || grid[index(x,y)]===1) return;
  ctx.fillStyle = selectedColor;
  ctx.fillRect(x,y,1,1);
  grid[index(x,y)] = 1;
  pixelsToPlace--;
  counterSpan.textContent = pixelsToPlace;

  // effet poétique: glow
  ctx.globalAlpha = 0.3;
  ctx.fillStyle = '#fff';
  ctx.fillRect(x-1,y-1,3,3);
  ctx.globalAlpha = 1;
}

canvas.addEventListener('mousedown', e=>{ isDragging=true; });
canvas.addEventListener('mouseup', e=>{ isDragging=false; });
canvas.addEventListener('mouseleave', e=>{ isDragging=false; });

canvas.addEventListener('mousemove', e=>{
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) * (canvas.width / rect.width));
  const y = Math.floor((e.clientY - rect.top) * (canvas.height / rect.height));

  // loupe
  loupe.style.display = 'block';
  loupe.style.left = e.pageX + 20 + 'px';
  loupe.style.top = e.pageY - 100 + 'px';
  const zoom=10;
  ctxLoupe.clearRect(0,0,loupe.width,loupe.height);
  ctxLoupe.drawImage(canvas, x-10, y-10, 20, 20, 0, 0, loupe.width, loupe.height);

  if(isDragging) placePixel(x,y);
});

canvas.addEventListener('click', e=>{
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) * (canvas.width / rect.width));
  const y = Math.floor((e.clientY - rect.top) * (canvas.height / rect.height));
  placePixel(x,y);
});

canvas.addEventListener('mouseleave', ()=>{
  loupe.style.display = 'none';
});
</script>
</body>
</html>

