<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Collective Canvas — Place your pixel</title>

<style>
:root {
  --bg:#0b0b0b;
  --panel:#0f0f0f;
  --frame:#ffffff44;
  --text:#f5f5f5;
  --muted:#888;
  --accent:#ffffff;
}

* { box-sizing:border-box; }

body {
  margin:0;
  height:100vh;
  background:var(--bg);
  color:var(--text);
  font-family:"Didot", serif;
  display:flex;
  align-items:center;
}

/* ===== LEFT PANEL ===== */
#panel {
  width:220px;
  padding:30px;
  display:flex;
  flex-direction:column;
  gap:30px;
}

/* Palette */
.palette {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}

.color {
  width:42px;
  height:42px;
  border-radius:50%;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.2);
  transition:transform .2s, box-shadow .2s;
}

.color.active {
  box-shadow:0 0 14px currentColor;
  transform:scale(1.1);
}

/* Counter */
.counter {
  font-size:14px;
  color:var(--muted);
}

.counter strong {
  color:var(--text);
  font-size:22px;
}

/* Validate */
button {
  margin-top:auto;
  padding:14px;
  background:transparent;
  border:1px solid rgba(255,255,255,.4);
  color:var(--text);
  cursor:pointer;
  transition:.3s;
}

button:hover:not(:disabled) {
  background:#fff;
  color:#000;
}

button:disabled {
  opacity:.3;
  cursor:not-allowed;
}

/* ===== STAGE ===== */
#stage {
  flex:1;
  display:flex;
  justify-content:center;
}

#frame {
  position:relative;
  width:750px;
  height:750px;
  background:#111;
  border:2px solid var(--frame);
  overflow:hidden;
  cursor:none;
}

canvas {
  width:100%;
  height:100%;
  image-rendering:pixelated;
}

/* ===== LOUPE ===== */
#loupe {
  position:absolute;
  width:64px;
  height:64px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,.7);
  pointer-events:none;
  display:none;
  overflow:hidden;
}

#loupe canvas {
  width:100%;
  height:100%;
  image-rendering:pixelated;
}

#centerDot {
  position:absolute;
  width:4px;
  height:4px;
  background:#fff;
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

/* ===== UPSELL ===== */
#upsell {
  position:absolute;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  font-size:14px;
  color:var(--muted);
  opacity:0;
  transition:.6s;
  pointer-events:none;
}
#upsell.show { opacity:1; }
#upsell span {
  color:var(--text);
  cursor:pointer;
  border-bottom:1px solid rgba(255,255,255,.3);
}
</style>
</head>

<body>

<div id="panel">
  <div class="palette" id="palette"></div>

  <div class="counter">
    Pixels restants<br>
    <strong id="count">5</strong>
  </div>

  <button id="validate" disabled>VALIDER</button>
</div>

<div id="stage">
  <div id="frame">
    <canvas id="canvas" width="1000" height="1000"></canvas>

    <div id="loupe">
      <canvas id="loupeCanvas" width="64" height="64"></canvas>
      <div id="centerDot"></div>
    </div>

    <div id="upsell">
      Il reste encore de la place.<br>
      <span>Ajouter un geste</span>
    </div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
let pixelsRemaining = 5; // ← lié à l'achat
let currentColor = "#ffffff";
let targetPixel = null;
const used = new Set();
const zoom = 4;

/* ===== ELEMENTS ===== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const loupe = document.getElementById("loupe");
const loupeCtx = document.getElementById("loupeCanvas").getContext("2d");
const frame = document.getElementById("frame");
const validate = document.getElementById("validate");
const countEl = document.getElementById("count");
const upsell = document.getElementById("upsell");

/* ===== PALETTE ===== */
const colors = [
  "#ffffff","#d4af37","#ff3b3b",
  "#ff9500","#ffd60a","#34c759",
  "#0a84ff","#5e5ce6","#bf5af2"
];

const palette = document.getElementById("palette");
colors.forEach(c=>{
  const d=document.createElement("div");
  d.className="color";
  d.style.background=c;
  d.onclick=()=>{
    document.querySelectorAll(".color").forEach(x=>x.classList.remove("active"));
    d.classList.add("active");
    currentColor=c;
  };
  palette.appendChild(d);
});
palette.firstChild.click();

/* ===== MOUSE MOVE ===== */
frame.addEventListener("mousemove",e=>{
  const rect=canvas.getBoundingClientRect();
  const scale=canvas.width/rect.width;

  const cx=e.clientX-rect.left;
  const cy=e.clientY-rect.top;

  let x=Math.floor(cx*scale);
  let y=Math.floor(cy*scale);

  if(x<0||y<0||x>=1000||y>=1000) return;

  targetPixel={x,y};

  loupe.style.display="block";
  loupe.style.left=cx-32+"px";
  loupe.style.top =cy-32+"px";

  loupeCtx.imageSmoothingEnabled=false;
  loupeCtx.clearRect(0,0,64,64);
  loupeCtx.drawImage(canvas,x-8,y-8,16,16,0,0,64,64);
});

/* ===== CLICK ===== */
frame.addEventListener("click",()=>{
  if(!targetPixel||pixelsRemaining<=0) return;
  validate.disabled=false;
});

/* ===== VALIDATE ===== */
validate.onclick=()=>{
  const key=targetPixel.x+","+targetPixel.y;
  if(used.has(key)) return;

  ctx.fillStyle=currentColor;
  ctx.fillRect(targetPixel.x,targetPixel.y,1,1);
  used.add(key);

  pixelsRemaining--;
  countEl.textContent=pixelsRemaining;
  validate.disabled=true;

  if(pixelsRemaining===0){
    upsell.classList.add("show");
  }
};

/* ===== UPSELL ACTION ===== */
upsell.querySelector("span").onclick=()=>{
  pixelsRemaining+=5;
  countEl.textContent=pixelsRemaining;
  upsell.classList.remove("show");
};
</script>

</body>
</html>




