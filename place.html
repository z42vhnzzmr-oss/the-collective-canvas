<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Place — The Collective Canvas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html, body {
  margin: 0;
  background: #0b0b0b;
  overflow: hidden;
  cursor: none;
  font-family: Inter, sans-serif;
}

#ui {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 10;
  color: #fff;
  font-size: 14px;
  opacity: 0.85;
}

#ui input {
  margin-top: 10px;
  width: 40px;
  height: 40px;
  border: none;
  background: none;
  cursor: pointer;
}

canvas {
  display: block;
}
</style>
</head>

<body>

<div id="ui">
  Pixels remaining: <strong id="remaining">20</strong><br>
  <input type="color" id="colorPicker" value="#ffffff">
</div>

<canvas id="canvas"></canvas>

<script>
/* ===== CONFIG ===== */
const GRID_SIZE = 1000;
const ZOOM = 10;
const LOUPE_RADIUS = 70;

/* ===== STATE ===== */
let pixelsRemaining = 20;
let currentColor = "#ffffff";
let mouse = { x: 0, y: 0, down: false };

/* ===== CANVAS SETUP ===== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/* Offscreen canvas = vraie œuvre */
const art = document.createElement("canvas");
art.width = GRID_SIZE;
art.height = GRID_SIZE;
const artCtx = art.getContext("2d");

artCtx.fillStyle = "#0b0b0b";
artCtx.fillRect(0, 0, GRID_SIZE, GRID_SIZE);

/* ===== UI ===== */
document.getElementById("colorPicker").addEventListener("input", e => {
  currentColor = e.target.value;
});

/* ===== EVENTS ===== */
canvas.addEventListener("mousemove", e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
  if (mouse.down) placePixel();
  draw();
});

canvas.addEventListener("mousedown", () => mouse.down = true);
canvas.addEventListener("mouseup", () => mouse.down = false);
canvas.addEventListener("mouseleave", () => mouse.down = false);

canvas.addEventListener("click", placePixel);

window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  draw();
});

/* ===== CORE ===== */
function placePixel() {
  if (pixelsRemaining <= 0) return;

  const px = Math.floor(mouse.x / ZOOM);
  const py = Math.floor(mouse.y / ZOOM);

  if (px < 0 || py < 0 || px >= GRID_SIZE || py >= GRID_SIZE) return;

  artCtx.fillStyle = currentColor;
  artCtx.fillRect(px, py, 1, 1);

  pixelsRemaining--;
  document.getElementById("remaining").textContent = pixelsRemaining;
}

/* ===== DRAW ===== */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.imageSmoothingEnabled = false;
  ctx.drawImage(
    art,
    0, 0, GRID_SIZE, GRID_SIZE,
    0, 0, GRID_SIZE * ZOOM, GRID_SIZE * ZOOM
  );

  // Loupe
  ctx.save();
  ctx.beginPath();
  ctx.arc(mouse.x, mouse.y, LOUPE_RADIUS, 0, Math.PI * 2);
  ctx.clip();

  ctx.drawImage(
    art,
    Math.floor(mouse.x / ZOOM) - 10,
    Math.floor(mouse.y / ZOOM) - 10,
    20, 20,
    mouse.x - LOUPE_RADIUS,
    mouse.y - LOUPE_RADIUS,
    LOUPE_RADIUS * 2,
    LOUPE_RADIUS * 2
  );
  ctx.restore();

  // Loupe border + glow
  ctx.beginPath();
  ctx.arc(mouse.x, mouse.y, LOUPE_RADIUS, 0, Math.PI * 2);
  ctx.strokeStyle = "rgba(255,255,255,0.9)";
  ctx.lineWidth = 2;
  ctx.shadowColor = "rgba(255,255,255,0.4)";
  ctx.shadowBlur = 12;
  ctx.stroke();
}

/* ===== INIT ===== */
draw();
</script>

</body>
</html>
