<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Place â€” The Collective Canvas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html, body {
  margin: 0;
  background: #0b0b0b;
  overflow: hidden;
  cursor: none;
  font-family: Inter, sans-serif;
}

#ui {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 10;
  color: #fff;
  font-size: 14px;
  opacity: 0.85;
}

#ui input {
  margin-top: 10px;
  width: 40px;
  height: 40px;
  border: none;
  background: none;
  cursor: pointer;
}

canvas {
  display: block;
}
</style>
</head>

<body>

<div id="ui">
  Pixels remaining: <strong id="remaining">20</strong><br>
  <input type="color" id="colorPicker" value="#ffffff">
</div>

<canvas id="screen"></canvas>

<script>
/* ===== CONFIG ===== */
const GRID_SIZE = 1000;
const ZOOM = 8;
const LOUPE_RADIUS = 70;

/* ===== STATE ===== */
let pixelsRemaining = 20;
let currentColor = "#ffffff";
let mouse = { x: 0, y: 0, down: false };

/* ===== CANVAS ===== */
const screen = document.getElementById("screen");
const ctx = screen.getContext("2d");

screen.width = window.innerWidth;
screen.height = window.innerHeight;

/* ===== ART CANVAS ===== */
const art = document.createElement("canvas");
art.width = GRID_SIZE;
art.height = GRID_SIZE;
const artCtx = art.getContext("2d");

artCtx.fillStyle = "#0b0b0b";
artCtx.fillRect(0, 0, GRID_SIZE, GRID_SIZE);

/* ===== CENTER ART ===== */
function artPosition() {
  const w = GRID_SIZE * ZOOM;
  const h = GRID_SIZE * ZOOM;
  return {
    x: (screen.width - w) / 2,
    y: (screen.height - h) / 2
  };
}

/* ===== UI ===== */
document.getElementById("colorPicker").addEventListener("input", e => {
  currentColor = e.target.value;
});

/* ===== EVENTS ===== */
screen.addEventListener("mousemove", e => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
  if (mouse.down) placePixel();
  draw();
});

screen.addEventListener("mousedown", () => mouse.down = true);
screen.addEventListener("mouseup", () => mouse.down = false);
screen.addEventListener("mouseleave", () => mouse.down = false);

screen.addEventListener("click", placePixel);

window.addEventListener("resize", () => {
  screen.width = window.innerWidth;
  screen.height = window.innerHeight;
  draw();
});

/* ===== HELPERS ===== */
function isInsideArt(mx, my) {
  const pos = artPosition();
  return (
    mx >= pos.x &&
    my >= pos.y &&
    mx <= pos.x + GRID_SIZE * ZOOM &&
    my <= pos.y + GRID_SIZE * ZOOM
  );
}

/* ===== CORE ===== */
function placePixel() {
  if (pixelsRemaining <= 0) return;
  if (!isInsideArt(mouse.x, mouse.y)) return;

  const pos = artPosition();
  const px = Math.floor((mouse.x - pos.x) / ZOOM);
  const py = Math.floor((mouse.y - pos.y) / ZOOM);

  if (px < 0 || py < 0 || px >= GRID_SIZE || py >= GRID_SIZE) return;

  artCtx.fillStyle = currentColor;
  artCtx.fillRect(px, py, 1, 1);

  pixelsRemaining--;
  document.getElementById("remaining").textContent = pixelsRemaining;
}

/* ===== DRAW ===== */
function draw() {
  ctx.clearRect(0, 0, screen.width, screen.height);

  const pos = artPosition();

  // Draw artwork
  ctx.imageSmoothingEnabled = false;
  ctx.drawImage(
    art,
    pos.x, pos.y,
    GRID_SIZE * ZOOM,
    GRID_SIZE * ZOOM
  );

  // Frame
  ctx.strokeStyle = "rgba(255,255,255,0.3)";
  ctx.lineWidth = 2;
  ctx.strokeRect(
    pos.x, pos.y,
    GRID_SIZE * ZOOM,
    GRID_SIZE * ZOOM
  );

  // Loupe only inside art
  if (isInsideArt(mouse.x, mouse.y)) {
    ctx.save();
    ctx.beginPath();
    ctx.arc(mouse.x, mouse.y, LOUPE_RADIUS, 0, Math.PI * 2);
    ctx.clip();

    const px = Math.floor((mouse.x - pos.x) / ZOOM);
    const py = Math.floor((mouse.y - pos.y) / ZOOM);

    ctx.drawImage(
      art,
      px - 10, py - 10, 20, 20,
      mouse.x - LOUPE_RADIUS,
      mouse.y - LOUPE_RADIUS,
      LOUPE_RADIUS * 2,
      LOUPE_RADIUS * 2
    );
    ctx.restore();

    // Loupe border
    ctx.beginPath();
    ctx.arc(mouse.x, mouse.y, LOUPE_RADIUS, 0, Math.PI * 2);
    ctx.strokeStyle = "rgba(255,255,255,0.9)";
    ctx.lineWidth = 2;
    ctx.shadowColor = "rgba(255,255,255,0.4)";
    ctx.shadowBlur = 10;
    ctx.stroke();
  }
}

/* ===== INIT ===== */
draw();
</script>

</body>
</html>
