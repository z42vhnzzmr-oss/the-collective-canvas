<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The Collective Canvas — Place</title>

<style>
html, body {
  margin: 0;
  background: #0b0b0b;
  overflow: hidden;
  font-family: Inter, sans-serif;
}

/* ================= UI ================= */
#ui {
  position: fixed;
  top: 24px;
  left: 24px;
  z-index: 20;
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(255,255,255,0.25);
  padding: 16px;
  border-radius: 12px;
  color: white;
  backdrop-filter: blur(8px);
}

#ui h3 {
  margin: 0 0 8px;
  font-size: 11px;
  letter-spacing: 1px;
  opacity: 0.7;
  text-transform: uppercase;
}

#remaining {
  font-size: 20px;
  margin-bottom: 12px;
}

#colorPicker {
  width: 56px;
  height: 56px;
  border-radius: 8px;
  border: 2px solid rgba(255,255,255,0.8);
  background: none;
  cursor: pointer;
}

#activeColor {
  margin-top: 8px;
  width: 56px;
  height: 12px;
  border-radius: 6px;
}

/* ================= CANVAS ================= */
#container {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

#main {
  image-rendering: pixelated;
  background: #000;
}

/* ================= LOUPE ================= */
#loupe {
  position: fixed;
  width: 140px;
  height: 140px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.9);
  pointer-events: none;
  overflow: hidden;
  z-index: 15;
  display: none;
}

#zoom {
  image-rendering: pixelated;
}

/* Réticule */
#loupe::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(#fff,#fff) center/2px 100%,
    linear-gradient(#fff,#fff) center/100% 2px;
  background-repeat: no-repeat;
  opacity: 0.8;
}
</style>
</head>

<body>

<!-- UI -->
<div id="ui">
  <h3>Pixels disponibles</h3>
  <div id="remaining">20</div>

  <h3>Choisir une couleur</h3>
  <input type="color" id="colorPicker" value="#ffffff">
  <div id="activeColor"></div>
</div>

<!-- Canvas -->
<div id="container">
  <canvas id="main" width="1000" height="1000"></canvas>
</div>

<!-- Loupe -->
<div id="loupe">
  <canvas id="zoom" width="140" height="140"></canvas>
</div>

<script>
/* ================= CONFIG ================= */
const SIZE = 1000;
let remaining = 20;
let currentColor = "#ffffff";

/* ================= CANVAS ================= */
const canvas = document.getElementById("main");
const ctx = canvas.getContext("2d");

const art = document.createElement("canvas");
art.width = SIZE;
art.height = SIZE;
const artCtx = art.getContext("2d");
artCtx.fillStyle = "#000";
artCtx.fillRect(0,0,SIZE,SIZE);

/* ================= UI ================= */
const remainingEl = document.getElementById("remaining");
const picker = document.getElementById("colorPicker");
const activeColor = document.getElementById("activeColor");
activeColor.style.background = currentColor;

picker.addEventListener("input", e => {
  currentColor = e.target.value;
  activeColor.style.background = currentColor;
});

/* ================= LOUPE ================= */
const loupe = document.getElementById("loupe");
const zoom = document.getElementById("zoom");
const zoomCtx = zoom.getContext("2d");

/* ================= STATE ================= */
let mouseX = 0;
let mouseY = 0;
let insideCanvas = false;

/* ================= MOUSE MOVE ================= */
window.addEventListener("mousemove", e => {
  mouseX = e.clientX;
  mouseY = e.clientY;

  const rect = canvas.getBoundingClientRect();

  insideCanvas =
    mouseX >= rect.left &&
    mouseX <= rect.right &&
    mouseY >= rect.top &&
    mouseY <= rect.bottom;

  if (insideCanvas) {
    canvas.style.cursor = "none";
    loupe.style.display = "block";
    loupe.style.left = mouseX + 20 + "px";
    loupe.style.top = mouseY + 20 + "px";
  } else {
    canvas.style.cursor = "default";
    loupe.style.display = "none";
  }
});

/* ================= CLICK ================= */
canvas.addEventListener("mousedown", e => {
  if (!insideCanvas || remaining <= 0) return;

  const rect = canvas.getBoundingClientRect();
  const x = Math.floor(e.clientX - rect.left);
  const y = Math.floor(e.clientY - rect.top);

  artCtx.fillStyle = currentColor;
  artCtx.fillRect(x, y, 1, 1);

  remaining--;
  remainingEl.textContent = remaining;
});

/* ================= DRAW ================= */
function draw() {
  ctx.drawImage(art, 0, 0);

  // Cadre clair
  ctx.strokeStyle = "rgba(255,255,255,0.9)";
  ctx.lineWidth = 2;
  ctx.strokeRect(0, 0, SIZE, SIZE);
}

/* ================= LOOP ================= */
function loop() {
  draw();

  if (insideCanvas) {
    const rect = canvas.getBoundingClientRect();
    const cx = Math.floor(mouseX - rect.left);
    const cy = Math.floor(mouseY - rect.top);

    zoomCtx.imageSmoothingEnabled = false;
    zoomCtx.clearRect(0,0,140,140);
    zoomCtx.drawImage(
      art,
      cx - 10, cy - 10,
      20, 20,
      0, 0,
      140, 140
    );
  }

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
