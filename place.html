<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>The Collective Canvas â€” Place</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #0b0b0b;
  overflow: hidden;
  cursor: none;
  font-family: Inter, sans-serif;
}

/* ================= UI ================= */
#ui {
  position: fixed;
  top: 24px;
  left: 24px;
  z-index: 10;
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(255,255,255,0.25);
  padding: 16px;
  border-radius: 12px;
  color: white;
  backdrop-filter: blur(8px);
}

#ui h3 {
  margin: 0 0 8px;
  font-size: 11px;
  letter-spacing: 1px;
  opacity: 0.7;
  text-transform: uppercase;
}

#remaining {
  font-size: 20px;
  margin-bottom: 12px;
}

#colorPicker {
  width: 56px;
  height: 56px;
  border-radius: 8px;
  border: 2px solid rgba(255,255,255,0.7);
  background: none;
  cursor: pointer;
}

#activeColor {
  margin-top: 8px;
  width: 56px;
  height: 12px;
  border-radius: 6px;
}

/* ================= CANVAS ================= */
#container {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

canvas {
  image-rendering: pixelated;
}

/* ================= LOUPE ================= */
#loupe {
  position: fixed;
  width: 140px;
  height: 140px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.8);
  pointer-events: none;
  overflow: hidden;
  z-index: 9;
}
</style>
</head>

<body>

<!-- UI -->
<div id="ui">
  <h3>Pixels disponibles</h3>
  <div id="remaining">20</div>

  <h3>Choisir une couleur</h3>
  <input type="color" id="colorPicker" value="#ffffff">
  <div id="activeColor"></div>
</div>

<!-- Canvas -->
<div id="container">
  <canvas id="main"></canvas>
</div>

<!-- Loupe -->
<div id="loupe">
  <canvas id="zoom" width="140" height="140"></canvas>
</div>

<script>
/* ================= CONFIG ================= */
const GRID_SIZE = 1000;
const PIXEL_SIZE = 1;
const ZOOM = 1;
let remaining = 20;
let currentColor = "#ffffff";

/* ================= CANVAS ================= */
const canvas = document.getElementById("main");
const ctx = canvas.getContext("2d");

canvas.width = GRID_SIZE;
canvas.height = GRID_SIZE;

const art = document.createElement("canvas");
art.width = GRID_SIZE;
art.height = GRID_SIZE;
const artCtx = art.getContext("2d");
artCtx.fillStyle = "#000";
artCtx.fillRect(0, 0, GRID_SIZE, GRID_SIZE);

/* ================= POSITION ================= */
const container = document.getElementById("container");
let rect;

/* ================= UI ================= */
const remainingEl = document.getElementById("remaining");
const picker = document.getElementById("colorPicker");
const activeColor = document.getElementById("activeColor");

activeColor.style.background = currentColor;

picker.addEventListener("input", e => {
  currentColor = e.target.value;
  activeColor.style.background = currentColor;
});

/* ================= LOUPE ================= */
const loupe = document.getElementById("loupe");
const zoom = document.getElementById("zoom");
const zoomCtx = zoom.getContext("2d");

/* ================= MOUSE ================= */
let mouseX = 0;
let mouseY = 0;

window.addEventListener("mousemove", e => {
  mouseX = e.clientX;
  mouseY = e.clientY;

  loupe.style.left = mouseX + 20 + "px";
  loupe.style.top = mouseY + 20 + "px";
});

/* ================= DRAW ================= */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(art, 0, 0);

  // Cadre visible
  ctx.strokeStyle = "rgba(255,255,255,0.9)";
  ctx.lineWidth = 2;
  ctx.strokeRect(0, 0, GRID_SIZE, GRID_SIZE);
}

/* ================= CLICK ================= */
canvas.addEventListener("mousedown", e => {
  rect = canvas.getBoundingClientRect();

  const x = Math.floor((e.clientX - rect.left));
  const y = Math.floor((e.clientY - rect.top));

  if (x < 0 || y < 0 || x >= GRID_SIZE || y >= GRID_SIZE) return;
  if (remaining <= 0) return;

  artCtx.fillStyle = currentColor;
  artCtx.fillRect(x, y, 1, 1);

  remaining--;
  remainingEl.textContent = remaining;
});

/* ================= LOOP ================= */
function loop() {
  draw();

  // Loupe render
  zoomCtx.imageSmoothingEnabled = false;
  zoomCtx.clearRect(0, 0, 140, 140);
  zoomCtx.drawImage(
    art,
    mouseX - rect?.left - 10,
    mouseY - rect?.top - 10,
    20, 20,
    0, 0,
    140, 140
  );

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
