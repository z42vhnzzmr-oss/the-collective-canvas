<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Place your fragments â€” The Collective Canvas</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&display=swap" rel="stylesheet">

<style>
body { background:#0b0b0b; color:#f5f5f5; font-family:Inter,sans-serif; margin:0; text-align:center; }
h1 { margin-top:40px; font-size:28px; }
#canvas-container { position:relative; display:inline-block; margin-top:20px; }
canvas { image-rendering: pixelated; border:1px solid #222; cursor:pointer; width:600px; height:600px; }
#loupe { position:absolute; pointer-events:none; border:2px solid #fff; border-radius:50%; display:none; width:200px; height:200px; }
#counter { margin-top:20px; font-size:16px; }
</style>
</head>

<body>
<h1>Place your fragments</h1>
<p>Click on the canvas to place your pixels. Use the loupe to see details.</p>

<div id="canvas-container">
  <canvas id="canvas" width="1000" height="1000"></canvas>
  <canvas id="loupe" width="200" height="200"></canvas>
</div>

<div id="counter">Pixels remaining: <span id="pixels-remaining">0</span></div>

<script>
// === INIT ===
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const loupe = document.getElementById('loupe');
const ctxLoupe = loupe.getContext('2d');
const counterSpan = document.getElementById('pixels-remaining');

let pixelsToPlace = 0;
let selectedColor = '#FF0000';
const grid = new Uint8Array(1000000); // 1000x1000

// === LIRE PARAMETRES URL ===
const urlParams = new URLSearchParams(window.location.search);
pixelsToPlace = parseInt(urlParams.get('pixels')) || 1;
selectedColor = urlParams.get('color') || '#FF0000';
counterSpan.textContent = pixelsToPlace;

// === FONCTION INDEX ===
function index(x,y){ return y*1000 + x; }

// === CLICK POUR POSER UN PIXEL ===
canvas.addEventListener('click', e=>{
  if(pixelsToPlace <= 0) return;
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) * (canvas.width / rect.width));
  const y = Math.floor((e.clientY - rect.top) * (canvas.height / rect.height));
  if(grid[index(x,y)] === 0){
    ctx.fillStyle = selectedColor;
    ctx.fillRect(x, y, 1, 1);
    grid[index(x,y)] = 1;
    pixelsToPlace--;
    counterSpan.textContent = pixelsToPlace;
  }
});

// === LOUPER SURVOL ===
canvas.addEventListener('mousemove', e=>{
  const rect = canvas.getBoundingClientRect();
  const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
  const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);

  loupe.style.display = 'block';
  loupe.style.left = e.pageX + 20 + 'px';
  loupe.style.top = e.pageY - 100 + 'px';

  const zoom = 10; // facteur zoom
  ctxLoupe.clearRect(0,0,loupe.width,loupe.height);
  ctxLoupe.drawImage(canvas, mouseX-10, mouseY-10, 20, 20, 0, 0, loupe.width, loupe.height);
});

canvas.addEventListener('mouseleave', ()=>{
  loupe.style.display = 'none';
});
</script>
</body>
</html>
